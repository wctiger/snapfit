(function(){"use strict";self.onmessage=function(n){if(n.data.canvas){const o=n.data.canvas,a=o.getContext("2d");if(!a)return"";const{targetWidth:r,targetHeight:w,photoPaperWidth:e,photoPaperHeight:l,backgroundColor:C,scaledData:m}=n.data,{imagePositions:s,rotatePaper:c}=v(e,l,r,w);c?(o.width=l,o.height=e):(o.width=e,o.height=l),a.fillStyle=C||"white",a.fillRect(0,0,o.width,o.height);for(const u of s)for(const f of u){const{pos_x:y,pos_y:i}=f;a.putImageData(m,y,i)}}};const t=5;function v(n,o,a,r){let w=!1;const e=Math.floor(n/(a+t)),l=Math.floor(o/(r+t)),C=Math.floor(o/(a+t)),m=Math.floor(n/(r+t));let s=e,c=l,u=(n-s*(a+t)+t)/2,f=(o-c*(r+t)+t)/2;C*m>e*l&&(w=!0,s=C,c=m,u=(o-s*(a+t)+t)/2,f=(n-c*(r+t)+t)/2),(u<0||f<0)&&console.warn("dimension calculation is wrong",{horizontalStartPoint:u,verticalStartPoint:f});const y=Array.from(Array(c),()=>Array(s));for(let i=0;i<s;i++){let x=u+(a+t)*i;for(let d=0;d<c;d++){let A=f+(r+t)*d;y[d][i]={pos_x:x,pos_y:A}}}return{imagePositions:y,rotatePaper:w}}})();
